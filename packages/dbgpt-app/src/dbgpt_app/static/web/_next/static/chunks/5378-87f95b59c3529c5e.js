(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5378],{23430:function(e,t,l){"use strict";var a=l(85893),r=l(25675),n=l.n(r);t.Z=function(e){let{src:t,label:l,width:r,height:s,className:i}=e;return(0,a.jsx)(n(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(i),width:r||44,height:s||44,src:t,alt:l||"db-icon"})}},43446:function(e,t,l){"use strict";var a=l(41468),r=l(64371),n=l(62418),s=l(25519),i=l(1375),o=l(45360),c=l(67294);t.Z=e=>{let{queryAgentURL:t="/api/v1/chat/completions",app_code:l}=e,[d,u]=(0,c.useState)({}),{scene:m}=(0,c.useContext)(a.p),p=(0,c.useCallback)(async e=>{let{data:a,chatId:c,onMessage:d,onClose:p,onDone:h,onError:x,ctrl:f}=e;if(f&&u(f),!(null==a?void 0:a.user_input)&&!(null==a?void 0:a.doc_id)){o.ZP.warning(r.Z.t("no_context_tip"));return}let g={conv_uid:c,app_code:l};a&&Object.keys(a).forEach(e=>{g[e]=a[e]});try{var v,_;await (0,i.L)("".concat((v="http://localhost:5670",void 0!==v)?v:"").concat(t),{method:"POST",headers:{"Content-Type":"application/json",[s.gp]:null!==(_=(0,n.n5)())&&void 0!==_?_:""},body:JSON.stringify(g),signal:f?f.signal:null,openWhenHidden:!0,async onopen(e){e.ok&&e.headers.get("content-type")===i.a||"application/json"!==e.headers.get("content-type")||e.json().then(e=>{null==d||d(e),null==h||h(),f&&f.abort()})},onclose(){f&&f.abort(),null==p||p()},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{if("chat_agent"===m)t=JSON.parse(t).vis;else{var l,r,n;a=JSON.parse(e.data),t=null===(l=a.choices)||void 0===l?void 0:null===(r=l[0])||void 0===r?void 0:null===(n=r.message)||void 0===n?void 0:n.content}}catch(e){t.replaceAll("\\n","\n")}"string"==typeof t?"[DONE]"===t?null==h||h():(null==t?void 0:t.startsWith("[ERROR]"))?null==x||x(null==t?void 0:t.replace("[ERROR]","")):null==d||d(t):(null==d||d(t),null==h||h())}})}catch(e){f&&f.abort(),null==x||x("Sorry, We meet some error, please try agin later.",e)}},[t,l,m]);return{chat:p,ctrl:d}}},48218:function(e,t,l){"use strict";var a=l(85893),r=l(82353),n=l(16165),s=l(67294);t.Z=e=>{let{width:t,height:l,scene:i}=e,o=(0,s.useCallback)(()=>{switch(i){case"chat_knowledge":return r.je;case"chat_with_db_execute":return r.zM;case"chat_excel":return r.DL;case"chat_with_db_qa":case"chat_dba":return r.RD;case"chat_dashboard":return r.In;case"chat_agent":return r.si;case"chat_normal":return r.O7;default:return}},[i]);return(0,a.jsx)(n.Z,{className:"w-".concat(t||7," h-").concat(l||7),component:o()})}},91467:function(e,t,l){"use strict";l.d(t,{TH:function(){return x},ZS:function(){return f}});var a=l(85893),r=l(89705),n=l(83062),s=l(96074),i=l(45030),o=l(85418),c=l(93967),d=l.n(c),u=l(36609),m=l(25675),p=l.n(m);l(67294);var h=l(48218);l(11873);let x=e=>{let{onClick:t,Icon:l="/pictures/card_chat.png",text:r=(0,u.t)("start_chat")}=e;return"string"==typeof l&&(l=(0,a.jsx)(p(),{src:l,alt:l,width:17,height:15})),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),t&&t()},children:[l,(0,a.jsx)("span",{children:r})]})},f=e=>{let{menu:t}=e;return(0,a.jsx)(o.Z,{menu:t,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,a.jsx)(r.Z,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})};t.ZP=e=>{let{RightTop:t,Tags:l,LeftBottom:r,RightBottom:o,onClick:c,rightTopHover:u=!0,logo:m,name:x,description:f,className:g,scene:v,code:_}=e;return"string"==typeof f&&(f=(0,a.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:f})),(0,a.jsx)("div",{className:d()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",g),children:(0,a.jsxs)("div",{onClick:c,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white bg-opacity-70 border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",children:[(0,a.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-3",children:v?(0,a.jsx)(h.Z,{scene:v,width:14,height:14}):m&&(0,a.jsx)(p(),{src:m,width:44,height:44,alt:x,className:"w-8 min-w-8 rounded-full max-w-none"})}),(0,a.jsx)("div",{className:"flex-1",children:x.length>6?(0,a.jsx)(n.Z,{title:x,children:(0,a.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})}):(0,a.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:x})})]}),(0,a.jsx)("span",{className:d()("shrink-0",{hidden:u,"group-hover:block":u}),onClick:e=>{e.stopPropagation()},children:t})]}),f,(0,a.jsx)("div",{className:"relative bottom-2",children:l}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{children:r}),(0,a.jsx)("div",{children:o})]}),_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Z,{className:"my-3"}),(0,a.jsx)(i.default.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:_})]})]})})}},95378:function(e,t,l){"use strict";l.r(t),l.d(t,{ChatContentContext:function(){return ew},default:function(){return eN}});var a=l(85893),r=l(41468),n=l(76212),s=l(43446),i=l(50888),o=l(90598),c=l(75750),d=l(58638),u=l(45360),m=l(66309),p=l(45030),h=l(74330),x=l(20640),f=l.n(x),g=l(67294),v=l(67421),_=l(65654),b=l(48218);let j=["magenta","orange","geekblue","purple","cyan","green"];var y=e=>{var t,l,r,s,x,y;let{isScrollToTop:w}=e,{appInfo:N,refreshAppInfo:k,handleChat:S,scrollRef:Z,temperatureValue:C,resourceValue:R,currentDialogue:P}=(0,g.useContext)(ew),{t:M}=(0,v.$G)(),T=(0,g.useMemo)(()=>{var e;return(null==N?void 0:null===(e=N.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent"},[N]),E=(0,g.useMemo)(()=>(null==N?void 0:N.is_collected)==="true",[N]),{run:V,loading:O}=(0,_.Z)(async()=>{let[e]=await (0,n.Vx)(E?(0,n.gD)({app_code:N.app_code}):(0,n.mo)({app_code:N.app_code}));if(!e)return await k()},{manual:!0}),L=(0,g.useMemo)(()=>{var e;return(null===(e=N.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[N.param_need]);if(!Object.keys(N).length)return null;let z=async()=>{let e=f()(location.href);u.ZP[e?"success":"error"](e?M("copy_success"):M("copy_failed"))};return(0,a.jsx)("div",{className:"h-20 mt-6 ".concat((null==N?void 0:N.recommend_questions)&&(null==N?void 0:null===(t=N.recommend_questions)||void 0===t?void 0:t.length)>0?"mb-6":""," sticky top-0 bg-transparent z-30 transition-all duration-400 ease-in-out"),children:w?(0,a.jsxs)("header",{className:"flex items-center justify-between w-full h-14 bg-[#ffffffb7] dark:bg-[rgba(41,63,89,0.4)]  px-8 transition-all duration-500 ease-in-out",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-2 bg-white",children:(0,a.jsx)(b.Z,{scene:T})}),(0,a.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,a.jsx)("span",{children:null==N?void 0:N.app_name}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(null==N?void 0:N.team_mode)&&(0,a.jsx)(m.Z,{color:"green",children:null==N?void 0:N.team_mode}),(null==N?void 0:null===(l=N.team_context)||void 0===l?void 0:l.chat_scene)&&(0,a.jsx)(m.Z,{color:"cyan",children:null==N?void 0:null===(r=N.team_context)||void 0===r?void 0:r.chat_scene})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-8",onClick:async()=>{await V()},children:[O?(0,a.jsx)(h.Z,{spinning:O,indicator:(0,a.jsx)(i.Z,{style:{fontSize:24},spin:!0})}):(0,a.jsx)(a.Fragment,{children:E?(0,a.jsx)(o.Z,{style:{fontSize:18},className:"text-yellow-400 cursor-pointer"}):(0,a.jsx)(c.Z,{style:{fontSize:18,cursor:"pointer"}})}),(0,a.jsx)(d.Z,{className:"text-lg",onClick:e=>{e.stopPropagation(),z()}})]})]}):(0,a.jsxs)("header",{className:"flex items-center justify-between w-5/6 h-full px-6  bg-[#ffffff99] border dark:bg-[rgba(255,255,255,0.1)] dark:border-[rgba(255,255,255,0.1)] rounded-2xl mx-auto transition-all duration-400 ease-in-out relative",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex w-12 h-12 justify-center items-center rounded-xl mr-4 bg-white",children:(0,a.jsx)(b.Z,{scene:T,width:16,height:16})}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center text-base text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] font-semibold gap-2",children:[(0,a.jsx)("span",{children:null==N?void 0:N.app_name}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(null==N?void 0:N.team_mode)&&(0,a.jsx)(m.Z,{color:"green",children:null==N?void 0:N.team_mode}),(null==N?void 0:null===(s=N.team_context)||void 0===s?void 0:s.chat_scene)&&(0,a.jsx)(m.Z,{color:"cyan",children:null==N?void 0:null===(x=N.team_context)||void 0===x?void 0:x.chat_scene})]})]}),(0,a.jsx)(p.default.Text,{className:"text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)] leading-6",ellipsis:{tooltip:!0},children:null==N?void 0:N.app_describe})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("div",{onClick:async()=>{await V()},className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:O?(0,a.jsx)(h.Z,{spinning:O,indicator:(0,a.jsx)(i.Z,{style:{fontSize:24},spin:!0})}):(0,a.jsx)(a.Fragment,{children:E?(0,a.jsx)(o.Z,{style:{fontSize:18},className:"text-yellow-400 cursor-pointer"}):(0,a.jsx)(c.Z,{style:{fontSize:18,cursor:"pointer"}})})})}),!!(null==N?void 0:null===(y=N.recommend_questions)||void 0===y?void 0:y.length)&&(0,a.jsxs)("div",{className:"absolute  bottom-[-40px] left-0",children:[(0,a.jsx)("span",{className:"text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)] leading-6",children:M("maybe_you_want_to_ask")}),N.recommend_questions.map((e,t)=>(0,a.jsx)(m.Z,{color:j[t],className:"text-xs p-1 px-2 cursor-pointer",onClick:async()=>{S((null==e?void 0:e.question)||"",{app_code:N.app_code,...L.includes("temperature")&&{temperature:C},...L.includes("resource")&&{select_param:"string"==typeof R?R:JSON.stringify(R)||P.select_param}}),setTimeout(()=>{var e,t;null===(e=Z.current)||void 0===e||e.scrollTo({top:null===(t=Z.current)||void 0===t?void 0:t.scrollHeight,behavior:"smooth"})},0)},children:e.question},e.id))]})]})})},w=l(62635),N=l(66017),k=l(5152),S=l.n(k);let Z=S()(()=>Promise.all([l.e(3662),l.e(7034),l.e(8674),l.e(930),l.e(3166),l.e(2837),l.e(2168),l.e(8163),l.e(7126),l.e(1265),l.e(4567),l.e(2398),l.e(1300),l.e(568),l.e(4309),l.e(4347),l.e(7562),l.e(3028),l.e(2510),l.e(8677),l.e(3783),l.e(9202),l.e(5265),l.e(5533),l.e(3764),l.e(188),l.e(1307),l.e(3768),l.e(5789),l.e(4275)]).then(l.bind(l,88331)),{loadableGenerated:{webpack:()=>[88331]},ssr:!1});var C=(0,g.forwardRef)((e,t)=>{let{className:l}=e,r=(0,g.useRef)(null),[n,s]=(0,g.useState)(!1),[i,o]=(0,g.useState)(!1),[c,d]=(0,g.useState)(!0),[u,m]=(0,g.useState)(!1),{history:p}=(0,g.useContext)(ew),h=(0,g.useRef)(!0),x=(0,g.useRef)(null);(0,g.useImperativeHandle)(t,()=>r.current);let f=(0,g.useCallback)(()=>{var e;if(!r.current)return;let t=r.current,l=t.scrollTop,a=t.scrollHeight,n=t.clientHeight,i=Number(null==t?void 0:null===(e=t.dataset)||void 0===e?void 0:e.lastScrollTop)||0,c=l>i?"down":"up";t.dataset.lastScrollTop=String(l),h.current="down"===c,d(l<=20),m(l+n>=a-20),l>=74?s(!0):s(!1);let u=a>n;o(u)},[]);(0,g.useEffect)(()=>{let e=r.current;if(e){e.addEventListener("scroll",f);let t=e.scrollHeight>e.clientHeight;o(t)}return()=>{e&&e.removeEventListener("scroll",f)}},[f]);let v=(0,g.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!r.current||!e&&!h.current)return;let t=r.current,{scrollTop:l,scrollHeight:a,clientHeight:n}=t;(l+n>=a-Math.max(50,.1*n)||e)&&(x.current&&cancelAnimationFrame(x.current),x.current=requestAnimationFrame(()=>{r.current&&r.current.scrollTo({top:r.current.scrollHeight,behavior:e?"smooth":"auto"}),x.current=null}))},[]),_=(0,g.useMemo)(()=>{let e=p[p.length-1];return e?{context:e.context,thinking:e.thinking}:null},[p]),b=(0,g.useRef)(p.length);(0,g.useEffect)(()=>{let e=p.length,t=e>b.current;t?(v(!0),b.current=e):v(!1)},[p.length,v]),(0,g.useEffect)(()=>{p.length===b.current&&v(!1)},[null==_?void 0:_.context,null==_?void 0:_.thinking,p.length,v]),(0,g.useEffect)(()=>()=>{x.current&&cancelAnimationFrame(x.current)},[]);let j=(0,g.useCallback)(()=>{r.current&&r.current.scrollTo({top:0,behavior:"smooth"})},[]),k=(0,g.useCallback)(()=>{r.current&&r.current.scrollTo({top:r.current.scrollHeight,behavior:"smooth"})},[]);return(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden relative ".concat(l||""),children:[(0,a.jsxs)("div",{ref:r,className:"h-full w-full mx-auto overflow-y-auto",children:[(0,a.jsx)(y,{isScrollToTop:n}),(0,a.jsx)(Z,{})]}),i&&(0,a.jsxs)("div",{className:"absolute right-4 md:right-6 bottom-[120px] md:bottom-[100px] flex flex-col gap-2 z-[999]",children:[!c&&(0,a.jsx)("button",{onClick:j,className:"w-9 h-9 md:w-10 md:h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200","aria-label":"Scroll to top",children:(0,a.jsx)(w.Z,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)] text-sm md:text-base"})}),!u&&(0,a.jsx)("button",{onClick:k,className:"w-9 h-9 md:w-10 md:h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-all duration-200","aria-label":"Scroll to bottom",children:(0,a.jsx)(N.Z,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)] text-sm md:text-base"})})]})]})}),R=l(89546),P=l(91467),M=l(32983),T=l(25675),E=l.n(T),V=l(11163),O=e=>{let{apps:t,refresh:l,loading:s,type:i}=e,d=async e=>{let[t]=await (0,n.Vx)("true"===e.is_collected?(0,n.gD)({app_code:e.app_code}):(0,n.mo)({app_code:e.app_code}));t||l()},{setAgent:u,model:m,setCurrentDialogInfo:p}=(0,g.useContext)(r.p),x=(0,V.useRouter)(),f=async e=>{if("native_app"===e.team_mode){let{chat_scene:t=""}=e.team_context,[,l]=await (0,n.Vx)((0,n.sW)({chat_mode:t}));l&&(null==p||p({chat_scene:l.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:l.chat_mode,app_code:e.app_code})),x.push("/chat?scene=".concat(t,"&id=").concat(l.conv_uid).concat(m?"&model=".concat(m):"")))}else{let[,t]=await (0,n.Vx)((0,n.sW)({chat_mode:"chat_agent"}));t&&(null==p||p({chat_scene:t.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:e.app_code})),null==u||u(e.app_code),x.push("/chat/?scene=chat_agent&id=".concat(t.conv_uid).concat(m?"&model=".concat(m):"")))}};return s?(0,a.jsx)(h.Z,{size:"large",className:"flex items-center justify-center h-full",spinning:s}):(0,a.jsx)("div",{className:"flex flex-wrap mt-4 w-full overflow-y-auto ",children:(null==t?void 0:t.length)>0?t.map(e=>{var t;return(0,a.jsx)(P.ZP,{name:e.app_name,description:e.app_describe,onClick:()=>f(e),RightTop:"true"===e.is_collected?(0,a.jsx)(o.Z,{onClick:t=>{t.stopPropagation(),d(e)},style:{height:"21px",cursor:"pointer",color:"#f9c533"}}):(0,a.jsx)(c.Z,{onClick:t=>{t.stopPropagation(),d(e)},style:{height:"21px",cursor:"pointer"}}),scene:(null==e?void 0:null===(t=e.team_context)||void 0===t?void 0:t.chat_scene)||"chat_agent"},e.app_code)}):(0,a.jsx)(M.Z,{image:(0,a.jsx)(E(),{src:"/pictures/empty.png",alt:"empty",width:142,height:133,className:"w-[142px] h-[133px]"}),className:"flex justify-center items-center w-full h-full min-h-[200px]"})})},L=l(62418),z=l(25278),D=l(14726),A=l(93967),I=l.n(A),H=function(){let{setCurrentDialogInfo:e}=(0,g.useContext)(r.p),{t}=(0,v.$G)(),l=(0,V.useRouter)(),[s,i]=(0,g.useState)(""),[o,c]=(0,g.useState)(!1),[d,u]=(0,g.useState)(!1),m=async()=>{let[,t]=await (0,n.Vx)((0,n.sW)({chat_mode:"chat_normal"}));t&&(null==e||e({chat_scene:t.chat_mode,app_code:t.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:t.chat_mode})),localStorage.setItem(L.rU,JSON.stringify({id:t.conv_uid,message:s})),l.push("/chat/?scene=chat_normal&id=".concat(t.conv_uid))),i("")};return(0,a.jsxs)("div",{className:"flex flex-1 h-12 p-2 pl-4 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl  border-t border-b border-l border-r ".concat(o?"border-[#0c75fc]":""),children:[(0,a.jsx)(z.default.TextArea,{placeholder:t("input_tips"),className:"w-full resize-none border-0 p-0 focus:shadow-none",value:s,autoSize:{minRows:1},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!d&&(e.preventDefault(),s.trim()&&m())},onChange:e=>{i(e.target.value)},onFocus:()=>{c(!0)},onBlur:()=>c(!1),onCompositionStart:()=>u(!0),onCompositionEnd:()=>u(!1)}),(0,a.jsx)(D.ZP,{type:"primary",className:I()("flex items-center justify-center w-14 h-8 rounded-lg text-sm  bg-button-gradient border-0",{"opacity-40 cursor-not-allowed":!s.trim()}),onClick:()=>{s.trim()&&m()},children:t("sent")})]})},W=l(28459),J=l(92783),$=l(36609),q=function(){let{setCurrentDialogInfo:e,model:t}=(0,g.useContext)(r.p),l=(0,V.useRouter)(),[s,i]=(0,g.useState)({app_list:[],total_count:0}),[o,c]=(0,g.useState)("recommend"),d=e=>(0,n.Vx)((0,n.yk)({...e,page_no:"1",page_size:"6"})),u=e=>(0,n.Vx)((0,n.mW)({page_no:"1",page_size:"6",...e})),{run:m,loading:p,refresh:h}=(0,_.Z)(async e=>{switch(o){case"recommend":return await u({});case"used":return await d({is_recent_used:"true",need_owner_info:"true",...e&&{app_name:e}});default:return[]}},{manual:!0,onSuccess:e=>{let[t,l]=e;if("recommend"===o)return i({app_list:l,total_count:(null==l?void 0:l.length)||0});i(l||{})},debounceWait:500});(0,g.useEffect)(()=>{m()},[o,m]);let x=[{value:"recommend",label:(0,$.t)("recommend_apps")},{value:"used",label:(0,$.t)("used_apps")}],{data:f}=(0,_.Z)(async()=>{let[,e]=await (0,n.Vx)((0,R.A)({is_hot_question:"true"}));return null!=e?e:[]});return(0,a.jsx)(W.ZP,{theme:{components:{Button:{defaultBorderColor:"white"},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,a.jsxs)("div",{className:"px-28 py-10 h-full flex flex-col justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(J.Z,{className:"backdrop-filter h-10 backdrop-blur-lg bg-white bg-opacity-30 border border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:x,value:o,onChange:e=>{c(e)}}),(0,a.jsxs)("span",{className:"flex items-center text-gray-500 gap-1 dark:text-slate-300",children:[(0,a.jsx)("span",{children:(0,$.t)("app_in_mind")}),(0,a.jsxs)("span",{className:"flex items-center cursor-pointer",onClick:()=>{l.push("/")},children:[(0,a.jsx)(E(),{src:"/pictures/explore_active.png",alt:"construct_image",width:24,height:24},"image_explore"),(0,a.jsx)("span",{className:"text-default",children:(0,$.t)("explore")})]}),(0,a.jsx)("span",{children:(0,$.t)("Discover_more")})]})]}),(0,a.jsx)(O,{apps:(null==s?void 0:s.app_list)||[],loading:p,refresh:h,type:o}),f&&f.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-medium text-xl my-4",children:(0,$.t)("help")}),(0,a.jsx)("div",{className:"flex justify-start gap-4",children:f.map(r=>(0,a.jsxs)("span",{className:"flex gap-4 items-center backdrop-filter backdrop-blur-lg cursor-pointer bg-white bg-opacity-70 border-0 rounded-lg shadow p-2 relative dark:bg-[#6f7f95] dark:bg-opacity-60",onClick:async()=>{let[,a]=await (0,n.Vx)((0,n.sW)({chat_mode:"chat_knowledge",model:t}));a&&(null==e||e({chat_scene:a.chat_mode,app_code:r.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:a.chat_mode,app_code:r.app_code})),localStorage.setItem(L.rU,JSON.stringify({id:a.conv_uid,message:r.question})),l.push("/chat/?scene=".concat(a.chat_mode,"&id=").concat(null==a?void 0:a.conv_uid)))},children:[(0,a.jsx)("span",{children:r.question}),(0,a.jsx)(E(),{src:"/icons/send.png",alt:"construct_image",width:20,height:20},"image_explore")]},r.id))})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)(H,{})})]})})},G=l(39332),F=l(30159),B=l(48689),U=l(52645),K=l(85576),Q=l(83062),Y=l(42952),X=l(34041),ee=l(39718);let et=e=>{if(!e)return e;let t=e.includes("/")&&e.split("/").pop()||e;if(t.includes(":")){let[e,l]=t.split(":"),a=e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("-");return"".concat(a,"-").concat(l.toUpperCase())}["Instruct","Chat","Base","Distill","Qwen","Llama"].forEach(e=>{let l=RegExp("-".concat(e,"$"),"i");t=t.replace(l,"");let a=RegExp("-Distill-(?:Qwen|Llama)","i");t=t.replace(a,"")});let l=t.match(/(\d+[BbMm])/);if(l){let e=l[1].toUpperCase();t=(t=t.replace(/[-_]?\d+[BbMm][-_]?/g,"-").replace(/-+/g,"-").replace(/-$/,"")).replace(/-A\d+B/i,""),t="".concat(t,"-").concat(e)}return t=t.replace(/-+/g,"-").replace(/^-|-$/g,"")};var el=(0,g.memo)(()=>{let{modelList:e}=(0,g.useContext)(r.p),{appInfo:t,modelValue:l,setModelValue:n}=(0,g.useContext)(ew),{t:s}=(0,v.$G)(),i=(0,g.useMemo)(()=>{var e;return(null===(e=t.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[t.param_need]);return i.includes("model")?(0,a.jsx)(X.default,{value:l,placeholder:s("choose_model"),className:"h-8 rounded-3xl",onChange:e=>{n(e)},popupMatchSelectWidth:280,optionLabelProp:"label",children:e.map(e=>(0,a.jsx)(X.default.Option,{value:e,label:et(e),children:(0,a.jsx)(Q.Z,{title:e,placement:"right",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(ee.Z,{model:e}),(0,a.jsx)("span",{className:"ml-2",children:et(e)})]})})},e))}):(0,a.jsx)(Q.Z,{title:s("model_tip"),children:(0,a.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,a.jsx)(Y.Z,{className:"text-xl cursor-not-allowed opacity-30"})})})}),ea=l(23430),er=l(90725),en=l(83266),es=l(2093),ei=l(23799),eo=(0,g.memo)(e=>{var t,l,r,s;let{fileList:i,setFileList:o,setLoading:c,fileName:d}=e,{setResourceValue:u,appInfo:m,refreshHistory:p,refreshDialogList:h,modelValue:x,resourceValue:f}=(0,g.useContext)(ew),{temperatureValue:b,maxNewTokensValue:j}=(0,g.useContext)(ew),y=(0,G.useSearchParams)(),w=null!==(t=null==y?void 0:y.get("scene"))&&void 0!==t?t:"",N=null!==(l=null==y?void 0:y.get("id"))&&void 0!==l?l:"",{t:k}=(0,v.$G)(),[S,Z]=(0,g.useState)([]),C=(0,g.useMemo)(()=>{var e;return(null===(e=m.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[m.param_need]),R=(0,g.useMemo)(()=>{var e,t;return C.includes("resource")&&(null===(e=null===(t=m.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="database"},[m.param_need,C]),P=(0,g.useMemo)(()=>{var e,t;return C.includes("resource")&&(null===(e=null===(t=m.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="knowledge"},[m.param_need,C]),M=(0,g.useMemo)(()=>{var e;return null===(e=m.param_need)||void 0===e?void 0:e.find(e=>"resource"===e.type)},[m.param_need]),{run:T,loading:E}=(0,_.Z)(async()=>await (0,n.Vx)((0,n.vD)(w)),{manual:!0,onSuccess:e=>{let[,t]=e;Z(null!=t?t:[])}});(0,es.Z)(async()=>{(R||P)&&!(null==M?void 0:M.bind_value)&&await T()},[R,P,M]);let V=(0,g.useMemo)(()=>{var e;return null===(e=S.map)||void 0===e?void 0:e.call(S,e=>({label:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ea.Z,{width:24,height:24,src:L.S$[e.type].icon,label:L.S$[e.type].label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.param]}),value:e.param}))},[S]),O=(0,g.useCallback)(async()=>{let e=new FormData;e.append("doc_files",null==i?void 0:i[0]),c(!0);let[t,l]=await (0,n.Vx)((0,n.qn)({convUid:N,chatMode:w,data:e,model:x,temperatureValue:b,maxNewTokensValue:j,config:{timeout:36e5}})).finally(()=>{c(!1)});l&&(u(l),await p(),await h())},[N,i,x,h,p,w,c,u]);if(!C.includes("resource"))return(0,a.jsx)(Q.Z,{title:k("extend_tip"),children:(0,a.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,a.jsx)(er.Z,{className:"text-lg cursor-not-allowed opacity-30"})})});switch(null==M?void 0:M.value){case"excel_file":case"text_file":case"image_file":case"audio_file":case"video_file":{let e="chat_excel"===w&&(!!d||!!(null===(r=i[0])||void 0===r?void 0:r.name)),t=k("chat_excel"===w?"file_tip":"file_upload_tip");return(0,a.jsx)(ei.default,{name:"file",accept:(()=>{switch(null==M?void 0:M.value){case"excel_file":return".csv,.xlsx,.xls";case"text_file":return".txt,.doc,.docx,.pdf,.md";case"image_file":return".jpg,.jpeg,.png,.gif,.bmp,.webp";case"audio_file":return".mp3,.wav,.ogg,.aac";case"video_file":return".mp4,.wav,.wav";default:return""}})(),fileList:i,showUploadList:!1,beforeUpload:(e,t)=>{null==o||o(t)},customRequest:O,disabled:e,children:(0,a.jsx)(Q.Z,{title:t,arrow:!1,placement:"bottom",children:(0,a.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,a.jsx)(en.Z,{className:I()("text-xl",{"cursor-pointer":!e})})})})})}case"database":case"knowledge":case"plugin":case"awel_flow":return f||u(null==V?void 0:null===(s=V[0])||void 0===s?void 0:s.value),(0,a.jsx)(X.default,{value:f,className:"w-52 h-8 rounded-3xl",onChange:e=>{u(e)},disabled:!!(null==M?void 0:M.bind_value),loading:E,options:V})}}),ec=e=>{let{ctrl:t,onLoadingChange:l}=e,{t:r}=(0,v.$G)(),{history:s,scrollRef:o,canAbort:c,replyLoading:d,currentDialogue:m,appInfo:p,temperatureValue:x,maxNewTokensValue:f,resourceValue:_,setTemperatureValue:b,setMaxNewTokensValue:j,refreshHistory:y,setCanAbort:w,setReplyLoading:N,handleChat:k}=(0,g.useContext)(ew),[S,Z]=(0,g.useState)([]),[C,R]=(0,g.useState)(!1),[P,M]=(0,g.useState)(!1),[T,V]=(0,g.useState)(!1);g.useEffect(()=>{null==l||l(C)},[C,l]);let O=(0,g.useMemo)(()=>{var e;return(null===(e=p.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[p.param_need]),z=(0,g.useMemo)(()=>[{tip:r("stop_replying"),icon:(0,a.jsx)(F.Z,{className:I()({"text-[#0c75fc]":c})}),can_use:c,key:"abort",onClick:()=>{c&&(t.abort(),setTimeout(()=>{w(!1),N(!1)},100))}},{tip:r("clear_all_caches"),icon:T?(0,a.jsx)(h.Z,{spinning:T,indicator:(0,a.jsx)(i.Z,{style:{fontSize:20}})}):(0,a.jsx)(B.Z,{}),can_use:!d,key:"clear_all_caches",onClick:async()=>{T||K.default.confirm({title:r("confirm_clear_all_caches"),content:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:r("clear_all_caches_content")}),(0,a.jsxs)("ul",{style:{paddingLeft:"20px",margin:"10px 0"},children:[(0,a.jsx)("li",{children:r("clear_cache_excel_db")}),(0,a.jsx)("li",{children:r("clear_cache_excel_files")}),(0,a.jsx)("li",{children:r("clear_cache_uploaded_excel")}),(0,a.jsx)("li",{children:r("clear_cache_excel_temp_db")}),(0,a.jsx)("li",{children:r("clear_cache_chat_history")}),(0,a.jsx)("li",{children:r("clear_cache_file_server")}),(0,a.jsx)("li",{children:r("clear_cache_model")})]}),(0,a.jsx)("p",{style:{color:"red",fontWeight:"bold"},children:r("clear_cache_warning")})]}),okText:r("confirm_clear"),cancelText:r("cancel"),okType:"danger",onOk:async()=>{V(!0);try{await (0,n.Vx)((0,n.YG)()),u.ZP.success(r("clear_cache_success")),setTimeout(()=>{window.location.reload()},3e3)}catch(e){u.ZP.error("".concat(r("clear_cache_failed"),": ").concat((null==e?void 0:e.message)||r("unknown_error")))}finally{V(!1)}}})}},{tip:r("erase_memory"),icon:P?(0,a.jsx)(h.Z,{spinning:P,indicator:(0,a.jsx)(i.Z,{style:{fontSize:20}})}):(0,a.jsx)(U.Z,{}),can_use:s.length>0,key:"clear",onClick:async()=>{P||(M(!0),await (0,n.Vx)((0,n.zR)(m.conv_uid)).finally(async()=>{await y(),M(!1)}))}}],[r,c,d,s,P,t,w,N,k,p.app_code,O,x,_,m.select_param,m.conv_uid,o,y]),D=(0,g.useMemo)(()=>{try{if(_){if("string"==typeof _)return JSON.parse(_).file_name||"";return _.file_name||""}return JSON.parse(m.select_param).file_name||""}catch(e){return""}},[_,m.select_param]);return(0,a.jsxs)("div",{className:"flex flex-col  mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between h-full w-full",children:[(0,a.jsxs)("div",{className:"flex gap-3 text-lg",children:[(0,a.jsx)(el,{}),(0,a.jsx)(eo,{fileList:S,setFileList:Z,setLoading:R,fileName:D})]}),(0,a.jsx)("div",{className:"flex gap-1",children:(0,a.jsx)(a.Fragment,{children:z.map(e=>(0,a.jsx)(Q.Z,{title:e.tip,arrow:!1,placement:"bottom",children:(0,a.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] text-lg ".concat(e.can_use?"cursor-pointer":"opacity-30 cursor-not-allowed"),onClick:()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)},children:e.icon})},e.key))})})]}),(0,a.jsx)(()=>{let e=(0,L.Ev)(_)||(0,L.Ev)(m.select_param)||[];return 0===e.length?null:(0,a.jsx)("div",{className:"group/item flex flex-wrap gap-2 mt-2",children:e.map((e,t)=>{var l,r;if("image_url"===e.type&&(null===(l=e.image_url)||void 0===l?void 0:l.url)){let l=e.image_url.fileName,r=(0,L.Hb)(e.image_url.url);return(0,a.jsxs)("div",{className:"flex flex-col border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:[(0,a.jsx)("div",{className:"w-32 h-32 mb-2 overflow-hidden flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded",children:(0,a.jsx)("img",{src:r,alt:l||"Preview",className:"max-w-full max-h-full object-contain"})}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:l})})]},"img-".concat(t))}if("file_url"===e.type&&(null===(r=e.file_url)||void 0===r?void 0:r.url)){let l=e.file_url.file_name;return(0,a.jsx)("div",{className:"flex items-center justify-between border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(E(),{src:"/icons/chat/excel.png",width:20,height:20,alt:"file-icon",className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:l})]})},"file-".concat(t))}return null})})},{}),C&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)(h.Z,{spinning:C,indicator:(0,a.jsx)(i.Z,{style:{fontSize:16},spin:!0})}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:r("parsing_data")})]})]})},ed=(0,g.forwardRef)((e,t)=>{var l,r;let{ctrl:n}=e,{t:s}=(0,v.$G)(),{replyLoading:o,handleChat:c,appInfo:d,currentDialogue:u,temperatureValue:m,maxNewTokensValue:p,resourceValue:x,setResourceValue:f,refreshDialogList:_}=(0,g.useContext)(ew),b=(0,G.useSearchParams)(),j=null!==(l=null==b?void 0:b.get("scene"))&&void 0!==l?l:"",y=null!==(r=null==b?void 0:b.get("select_param"))&&void 0!==r?r:"",[w,N]=(0,g.useState)(""),[k,S]=(0,g.useState)(!1),[Z,C]=(0,g.useState)(!1),[R,P]=(0,g.useState)(!1),M=(0,g.useRef)(0),T=(0,g.useMemo)(()=>{var e;return(null===(e=d.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[d.param_need]),E=async()=>{let e;M.current++,N("");let t=(0,L.Ev)(x);if(t.length>0){"chat_excel"!==j&&f(null);let l=[...t];l.push({type:"text",text:w}),e={role:"user",content:l}}else e=w;let l={app_code:d.app_code||"",...T.includes("temperature")&&{temperature:m},...T.includes("max_new_tokens")&&{max_new_tokens:p},select_param:y,...T.includes("resource")&&{select_param:"string"==typeof x?x:JSON.stringify(x)||u.select_param}};await c(e,l),1===M.current&&await _()};return(0,g.useImperativeHandle)(t,()=>({setUserInput:N})),(0,a.jsx)("div",{className:"flex flex-col w-5/6 mx-auto pt-4 pb-6 bg-transparent",children:(0,a.jsxs)("div",{className:"flex flex-1 flex-col bg-white dark:bg-[rgba(255,255,255,0.16)] px-5 py-4 pt-2 rounded-xl relative border-t border-b border-l border-r dark:border-[rgba(255,255,255,0.6)] ".concat(k?"border-[#0c75fc]":""),id:"input-panel",children:[(0,a.jsx)(ec,{ctrl:n,onLoadingChange:P}),(0,a.jsx)(z.default.TextArea,{placeholder:s("input_tips"),className:"w-full h-20 resize-none border-0 p-0 focus:shadow-none dark:bg-transparent",value:w,onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!Z&&(e.preventDefault(),!w.trim()||o||R||E())},onChange:e=>{N(e.target.value)},onFocus:()=>{S(!0)},onBlur:()=>S(!1),onCompositionStart:()=>C(!0),onCompositionEnd:()=>C(!1)}),(0,a.jsx)(D.ZP,{type:"primary",className:I()("flex items-center justify-center w-14 h-8 rounded-lg text-sm absolute right-4 bottom-3 bg-button-gradient border-0",{"cursor-not-allowed":!w.trim()||R,"opacity-40":R}),disabled:R,onClick:()=>{!o&&w.trim()&&!R&&E()},children:o?(0,a.jsx)(h.Z,{spinning:o,indicator:(0,a.jsx)(i.Z,{className:"text-white"})}):s("sent")})]})})}),eu=l(20046),em=l(14313),ep=l(94155),eh=l(21612),ex=l(86250);let{Sider:ef}=eh.default,eg={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8},ev=e=>{var t,l;let{item:s,refresh:i,historyLoading:o}=e,{t:c}=(0,v.$G)(),d=(0,G.useRouter)(),m=(0,G.useSearchParams)(),h=null!==(t=null==m?void 0:m.get("id"))&&void 0!==t?t:"",x=null!==(l=null==m?void 0:m.get("scene"))&&void 0!==l?l:"",{setCurrentDialogInfo:_}=(0,g.useContext)(r.p),b=(0,g.useMemo)(()=>s.default?s.default&&!h&&!x:s.conv_uid===h&&s.chat_mode===x,[h,x,s]),j=()=>{K.default.confirm({title:c("delete_chat"),content:c("delete_chat_confirm"),centered:!0,onOk:async()=>{let[e]=await (0,n.Vx)((0,n.MX)(s.conv_uid));e||(await (null==i?void 0:i()),s.conv_uid===h&&d.push("/chat"))}})};return(0,a.jsxs)(ex.Z,{align:"center",className:"group/item w-full h-12 p-3 rounded-lg  hover:bg-white dark:hover:bg-theme-dark cursor-pointer mb-2 relative ".concat(b?"bg-white dark:bg-theme-dark bg-opacity-100":""),onClick:()=>{o||(s.default||null==_||_({chat_scene:s.chat_mode,app_code:s.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:s.chat_mode,app_code:s.app_code})),d.push(s.default?"/chat":"?scene=".concat(s.chat_mode,"&id=").concat(s.conv_uid)))},children:[(0,a.jsx)(Q.Z,{title:s.chat_mode,children:(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-3 bg-white",children:s.icon})}),(0,a.jsx)("div",{className:"flex flex-1 line-clamp-1",children:(0,a.jsx)(p.default.Text,{ellipsis:{tooltip:!0},children:s.label})}),!s.default&&(0,a.jsxs)("div",{className:"flex gap-1 ml-1",children:[(0,a.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation()},children:(0,a.jsx)(eu.Z,{style:{fontSize:16},onClick:()=>{let e=f()("".concat(location.origin,"/chat?scene=").concat(s.chat_mode,"&id=").concat(s.conv_uid));u.ZP[e?"success":"error"](e?c("copy_success"):c("copy_failed"))}})}),(0,a.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation(),j()},children:(0,a.jsx)(B.Z,{style:{fontSize:16}})})]}),(0,a.jsx)("div",{className:" w-1 rounded-sm bg-[#0c75fc] absolute top-1/2 left-0 -translate-y-1/2 transition-all duration-500 ease-in-out ".concat(b?"h-5":"w-0 h-0")})]})};var e_=e=>{var t;let{dialogueList:l=[],refresh:n,historyLoading:s,listLoading:i,order:o}=e,c=(0,G.useSearchParams)(),d=null!==(t=null==c?void 0:c.get("scene"))&&void 0!==t?t:"",{t:u}=(0,v.$G)(),{mode:m}=(0,g.useContext)(r.p),[p,x]=(0,g.useState)("chat_dashboard"===d),f=(0,g.useMemo)(()=>p?{...eg,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...eg,borderLeft:"1px solid #d6d8da"},[p]),_=(0,g.useMemo)(()=>{let e=l[1]||[];return(null==e?void 0:e.length)>0?e.map(e=>({...e,label:e.user_input||e.select_param,key:e.conv_uid,icon:(0,a.jsx)(b.Z,{scene:e.chat_mode}),default:!1})):[]},[l]);return(0,a.jsx)(ef,{className:"bg-[#ffffff80]  border-r  border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:m,width:280,collapsible:!0,collapsed:p,collapsedWidth:0,trigger:p?(0,a.jsx)(em.Z,{className:"text-base"}):(0,a.jsx)(ep.Z,{className:"text-base"}),zeroWidthTriggerStyle:f,onCollapse:e=>x(e),children:(0,a.jsxs)("div",{className:"flex flex-col h-full w-full bg-transparent px-4 pt-6  ",children:[(0,a.jsx)("div",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] mb-4 line-clamp-1",children:u("dialog_list")}),(0,a.jsxs)(ex.Z,{flex:1,vertical:!0,className:"overflow-y-auto",children:[(0,a.jsx)(ev,{item:{label:u("assistant"),key:"default",icon:(0,a.jsx)(E(),{src:"/LOGO_SMALL.png",alt:"default",width:24,height:24,className:"flex-1"}),default:!0},order:o}),(0,a.jsx)(h.Z,{spinning:i,className:"mt-2",children:!!(null==_?void 0:_.length)&&_.map(e=>(0,a.jsx)(ev,{item:e,refresh:n,historyLoading:s,order:o},null==e?void 0:e.key))})]})]})})};let eb=S()(()=>Promise.all([l.e(3662),l.e(7034),l.e(8674),l.e(930),l.e(3166),l.e(2837),l.e(2168),l.e(8163),l.e(7126),l.e(4567),l.e(1300),l.e(4309),l.e(4347),l.e(7562),l.e(3028),l.e(3764),l.e(188),l.e(3768),l.e(979)]).then(l.bind(l,47760)),{loadableGenerated:{webpack:()=>[47760]},ssr:!1}),ej=S()(()=>Promise.all([l.e(3662),l.e(7034),l.e(8674),l.e(930),l.e(3166),l.e(2837),l.e(2168),l.e(8163),l.e(7126),l.e(1265),l.e(4567),l.e(2398),l.e(1300),l.e(568),l.e(4309),l.e(4347),l.e(7562),l.e(3028),l.e(2510),l.e(8677),l.e(3783),l.e(9202),l.e(5265),l.e(5533),l.e(3764),l.e(188),l.e(2472),l.e(3768),l.e(5789),l.e(4117)]).then(l.bind(l,8334)),{loadableGenerated:{webpack:()=>[8334]},ssr:!1}),{Content:ey}=eh.default,ew=(0,g.createContext)({history:[],replyLoading:!1,scrollRef:{current:null},canAbort:!1,chartsData:[],agent:"",currentDialogue:{},appInfo:{},temperatureValue:.5,maxNewTokensValue:1024,resourceValue:{},modelValue:"",setModelValue:()=>{},setResourceValue:()=>{},setTemperatureValue:()=>{},setMaxNewTokensValue:()=>{},setAppInfo:()=>{},setAgent:()=>{},setCanAbort:()=>{},setReplyLoading:()=>{},refreshDialogList:()=>{},refreshHistory:()=>{},refreshAppInfo:()=>{},setHistory:()=>{},handleChat:()=>Promise.resolve()});var eN=()=>{var e,t,l,i;let{model:o,currentDialogInfo:c}=(0,g.useContext)(r.p),{isContract:d,setIsContract:u,setIsMenuExpand:m}=(0,g.useContext)(r.p),{chat:p,ctrl:x}=(0,s.Z)({app_code:c.app_code||""}),f=(0,G.useSearchParams)(),v=null!==(e=null==f?void 0:f.get("id"))&&void 0!==e?e:"",b=null!==(t=null==f?void 0:f.get("scene"))&&void 0!==t?t:"",j=null!==(l=null==f?void 0:f.get("knowledge_id"))&&void 0!==l?l:"",y=null!==(i=null==f?void 0:f.get("db_name"))&&void 0!==i?i:"",w=(0,g.useRef)(null),N=(0,g.useRef)(1),k=(0,g.useRef)(null),S=(0,g.useRef)(void 0),[Z,R]=(0,g.useState)([]),[P]=(0,g.useState)(),[M,T]=(0,g.useState)(!1),[E,V]=(0,g.useState)(!1),[O,z]=(0,g.useState)(""),[D,A]=(0,g.useState)({}),[I,H]=(0,g.useState)(),[W,J]=(0,g.useState)(),[$,F]=(0,g.useState)(),[B,U]=(0,g.useState)("");(0,g.useEffect)(()=>{var e,t,l,a,r,n,s,i;H((null===(e=null==D?void 0:null===(t=D.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type)[0])||void 0===e?void 0:e.value)||.6),J((null===(l=null==D?void 0:null===(a=D.param_need)||void 0===a?void 0:a.filter(e=>"max_new_tokens"===e.type)[0])||void 0===l?void 0:l.value)||4e3),U((null===(r=null==D?void 0:null===(n=D.param_need)||void 0===n?void 0:n.filter(e=>"model"===e.type)[0])||void 0===r?void 0:r.value)||o),F(j||y||(null===(s=null==D?void 0:null===(i=D.param_need)||void 0===i?void 0:i.filter(e=>"resource"===e.type)[0])||void 0===s?void 0:s.bind_value))},[D,y,j,o]),(0,g.useEffect)(()=>{m("chat_dashboard"!==b),v&&b&&u(!1)},[v,b,u,m]);let K=(0,g.useMemo)(()=>!v&&!b,[v,b]),{data:Q=[],refresh:Y,loading:X}=(0,_.Z)(async()=>await (0,n.Vx)((0,n.iP)())),{run:ee,refresh:et}=(0,_.Z)(async()=>await (0,n.Vx)((0,n.BN)({...c})),{manual:!0,onSuccess:e=>{let[,t]=e;A(t||{})}}),el=(0,g.useMemo)(()=>{let[,e]=Q;return(null==e?void 0:e.find(e=>e.conv_uid===v))||{}},[v,Q]);(0,g.useEffect)(()=>{let e=(0,L.a_)();c.chat_scene!==b||K||e&&e.message||ee()},[v,c,K,ee,b]);let{run:ea,loading:er,refresh:en}=(0,_.Z)(async()=>await (0,n.Vx)((0,n.$i)(v)),{manual:!0,onSuccess:e=>{let[,t]=e,l=null==t?void 0:t.filter(e=>"view"===e.role);l&&l.length>0&&(N.current=l[l.length-1].order+1),R(t||[])}}),ei=(0,g.useCallback)((e,t)=>new Promise(l=>{let a=(0,L.a_)(),r=new AbortController;if(T(!0),Z&&Z.length>0){var n,s;let e=null==Z?void 0:Z.filter(e=>"view"===e.role),t=null==Z?void 0:Z.filter(e=>"human"===e.role);N.current=((null===(n=e[e.length-1])||void 0===n?void 0:n.order)||(null===(s=t[t.length-1])||void 0===s?void 0:s.order))+1}let i="";if("string"==typeof e)i=e;else{let t=e.content||[],l=t.filter(e=>"text"===e.type),a=t.filter(e=>"text"!==e.type);l.length>0&&(i=l.map(e=>e.text).join(" "));let r=a.map(e=>{if("image_url"===e.type){var t,l;let a=(null===(t=e.image_url)||void 0===t?void 0:t.url)||"",r=(0,L.Hb)(a),n=(null===(l=e.image_url)||void 0===l?void 0:l.fileName)||"image";return"\n![".concat(n,"](").concat(r,")")}if("video"!==e.type)return"";{let t=e.video||"",l=(0,L.Hb)(t);return"\n[Video](".concat(l,")")}}).filter(e=>""!==e).join("\n");r&&(i=i+"\n"+r)}let o=[...a&&a.id===v?[]:Z,{role:"human",context:i,model_name:(null==t?void 0:t.model_name)||B,order:N.current,time_stamp:0},{role:"view",context:"",model_name:(null==t?void 0:t.model_name)||B,order:N.current,time_stamp:0,thinking:!0}],c=o.length-1;R([...o]);let d={chat_mode:b,model_name:B,user_input:e};if(t&&Object.assign(d,t),"chat_dashboard"!==b){let e=S.current||localStorage.getItem("dbgpt_prompt_code_".concat(v));e&&(d.prompt_code=e,localStorage.removeItem("dbgpt_prompt_code_".concat(v)))}p({data:d,ctrl:r,chatId:v,onMessage:e=>{V(!0),(null==t?void 0:t.incremental)?(o[c].context+=e,o[c].thinking=!1):(o[c].context=e,o[c].thinking=!1),R([...o])},onDone:()=>{T(!1),V(!1),l()},onClose:()=>{T(!1),V(!1),l()},onError:e=>{T(!1),V(!1),o[c].context=e,o[c].thinking=!1,R([...o]),l()}})}),[v,Z,B,p,b]);return(0,es.Z)(async()=>{if(K)return;let e=(0,L.a_)();e&&e.id===v||await ea()},[v,b,ea]),(0,g.useEffect)(()=>{K&&(N.current=1,R([]))},[K]),(0,a.jsx)(ew.Provider,{value:{history:Z,replyLoading:M,scrollRef:w,canAbort:E,chartsData:P||[],agent:O,currentDialogue:el,appInfo:D,temperatureValue:I,maxNewTokensValue:W,resourceValue:$,modelValue:B,setModelValue:U,setResourceValue:F,setTemperatureValue:H,setMaxNewTokensValue:J,setAppInfo:A,setAgent:z,setCanAbort:V,setReplyLoading:T,handleChat:ei,refreshDialogList:Y,refreshHistory:en,refreshAppInfo:et,setHistory:R},children:(0,a.jsx)(ex.Z,{flex:1,children:(0,a.jsxs)(eh.default,{className:"bg-gradient-light bg-cover bg-center dark:bg-gradient-dark",children:[(0,a.jsx)(e_,{refresh:Y,dialogueList:Q,listLoading:X,historyLoading:er,order:N}),(0,a.jsx)(eh.default,{className:"bg-transparent",children:"chat_dashboard"===b?d?(0,a.jsx)(eb,{}):(0,a.jsx)(ej,{}):K?(0,a.jsx)(ey,{children:(0,a.jsx)(q,{})}):(0,a.jsx)(h.Z,{spinning:er,className:"w-full h-full m-auto",children:(0,a.jsxs)(ey,{className:"flex flex-col h-screen",children:[(0,a.jsx)(C,{ref:w,className:"flex-1"}),(0,a.jsx)(ed,{ref:k,ctrl:x})]})})})]})})})}},11873:function(){}}]);