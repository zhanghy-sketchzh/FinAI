"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6818],{7332:function(e,s,a){a.r(s);var t=a(85893),l=a(39718),n=a(18102),c=a(96074),i=a(93967),r=a.n(i),o=a(67294),d=a(67421),u=a(73913),x=a(32966);s.default=(0,o.memo)(e=>{let{message:s,index:a}=e,{scene:i}=(0,o.useContext)(u.MobileChatContext),{context:p,model_name:m,role:f,thinking:h}=s,{t:v}=(0,d.$G)(),g=(0,o.useMemo)(()=>"view"===f,[f]),y=(0,o.useRef)(null),{value:w}=(0,o.useMemo)(()=>{if("string"!=typeof p)return{relations:[],value:"",cachePluginContext:[]};let[e,s]=p.split("	relations:"),a=s?s.split(","):[],t=[],l=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var s;let a=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(a),c="<custom-view>".concat(l,"</custom-view>");return t.push({...n,result:j(null!==(s=n.result)&&void 0!==s?s:"")}),l++,c}catch(s){return console.log(s.message,s),e}});return{relations:a,cachePluginContext:t,value:n}},[p]),j=e=>e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");return(0,t.jsxs)("div",{className:r()("flex w-full",{"justify-end":!g}),ref:y,children:[!g&&(0,t.jsx)("div",{className:"flex bg-[#0C75FC]  text-white p-3 rounded-xl rounded-br-none",children:p}),g&&(0,t.jsxs)("div",{className:"flex max-w-full flex-col flex-wrap bg-white dark:bg-[rgba(255,255,255,0.16)] p-3 rounded-xl rounded-bl-none",children:["string"==typeof p&&"chat_agent"===i&&(0,t.jsx)(n.default,{children:null==w?void 0:w.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}),"string"==typeof p&&"chat_agent"!==i&&(0,t.jsx)(n.default,{children:j(w)}),h&&!p&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:v("thinking")}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]}),!h&&(0,t.jsx)(c.Z,{className:"my-2"}),(0,t.jsxs)("div",{className:r()("opacity-0 h-0 w-0",{"opacity-100 flex items-center justify-between gap-6 w-auto h-auto":!h}),children:[(0,t.jsx)(x.default,{content:s,index:a,chatDialogRef:y}),"chat_agent"!==i&&(0,t.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,t.jsx)(l.Z,{width:14,height:14,model:m}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:m})]})]})]})]})})},36818:function(e,s,a){a.r(s);var t=a(85893),l=a(67294),n=a(73913),c=a(7332);s.default=(0,l.memo)(()=>{let{history:e}=(0,l.useContext)(n.MobileChatContext),s=(0,l.useMemo)(()=>e.filter(e=>["view","human"].includes(e.role)),[e]);return(0,t.jsx)("div",{className:"flex flex-col gap-4",children:!!s.length&&s.map((e,s)=>(0,t.jsx)(c.default,{message:e,index:s},e.context+s))})})},5583:function(e,s,a){a.r(s);var t=a(85893),l=a(85265),n=a(66309),c=a(25278),i=a(14726),r=a(67294),o=a(67421);s.default=e=>{let{open:s,setFeedbackOpen:a,list:d,feedback:u,loading:x}=e,[p,m]=(0,r.useState)([]),[f,h]=(0,r.useState)(""),{t:v}=(0,o.$G)();return(0,t.jsx)(l.Z,{title:v("feedback_title"),placement:"bottom",open:s,onClose:()=>a(!1),destroyOnClose:!0,height:"auto",children:(0,t.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,t.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==d?void 0:d.map(e=>{let s=p.findIndex(s=>s.reason_type===e.reason_type)>-1;return(0,t.jsx)(n.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(s?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{m(s=>{let a=s.findIndex(s=>s.reason_type===e.reason_type);return a>-1?[...s.slice(0,a),...s.slice(a+1)]:[...s,e]})},children:e.reason},e.reason_type)})}),(0,t.jsx)(c.default.TextArea,{placeholder:v("describe_problem"),className:"h-24 resize-none mb-2",value:f,onChange:e=>h(e.target.value.trim())}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)(i.ZP,{className:"w-16 h-8",onClick:()=>{a(!1)},children:v("cancel")}),(0,t.jsx)(i.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=p.map(e=>e.reason_type);await (null==u?void 0:u({feedback_type:"unlike",reason_types:e,remark:f}))},loading:x,children:v("verify")})]})]})})}},32966:function(e,s,a){a.r(s);var t=a(85893),l=a(76212),n=a(65429),c=a(15381),i=a(57132),r=a(65654),o=a(31418),d=a(96074),u=a(14726),x=a(93967),p=a.n(x),m=a(20640),f=a.n(m),h=a(67294),v=a(67421),g=a(73913),y=a(5583);s.default=e=>{var s;let{content:a,index:x,chatDialogRef:m}=e,{conv_uid:w,history:j,scene:_}=(0,h.useContext)(g.MobileChatContext),{message:b}=o.Z.useApp(),{t:k}=(0,v.$G)(),[N,C]=(0,h.useState)(!1),[Z,S]=(0,h.useState)(null==a?void 0:null===(s=a.feedback)||void 0===s?void 0:s.feedback_type),[$,M]=(0,h.useState)([]),F=async e=>{var s;let a=null==e?void 0:e.replace(/\trelations:.*/g,""),t=f()((null===(s=m.current)||void 0===s?void 0:s.textContent)||a);t?a?b.success(k("copy_success")):b.warning(k("copy_empty")):b.error(k("copy_failed"))},{run:P,loading:V}=(0,r.Z)(async e=>await (0,l.Vx)((0,l.zx)({conv_uid:w,message_id:a.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,s]=e;S(null==s?void 0:s.feedback_type),b.success(k("feedback_success")),C(!1)}}),{run:z}=(0,r.Z)(async()=>await (0,l.Vx)((0,l.Ir)({conv_uid:w,message_id:(null==a?void 0:a.order)+""})),{manual:!0,onSuccess:e=>{let[,s]=e;s&&(S("none"),b.success(k("operation_success")))}}),{run:A}=(0,r.Z)(async()=>await (0,l.Vx)((0,l.Jr)()),{manual:!0,onSuccess:e=>{let[,s]=e;M(s||[]),s&&C(!0)}}),{run:G,loading:I}=(0,r.Z)(async()=>await (0,l.Vx)((0,l.Ty)({conv_id:w,round_index:0})),{manual:!0,onSuccess:()=>{b.success(k("operation_success"))}});return(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.Z,{className:p()("cursor-pointer",{"text-[#0C75FC]":"like"===Z}),onClick:async()=>{if("like"===Z){await z();return}await P({feedback_type:"like"})}}),(0,t.jsx)(c.Z,{className:p()("cursor-pointer",{"text-[#0C75FC]":"unlike"===Z}),onClick:async()=>{if("unlike"===Z){await z();return}await A()}}),(0,t.jsx)(y.default,{open:N,setFeedbackOpen:C,list:$,feedback:P,loading:V})]}),(0,t.jsx)(d.Z,{type:"vertical"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.Z,{className:"cursor-pointer",onClick:()=>F(a.context)}),j.length-1===x&&"chat_agent"===_&&(0,t.jsx)(u.ZP,{loading:I,size:"small",onClick:async()=>{await G()},className:"text-xs",children:k("stop_topic")})]})]})}}}]);