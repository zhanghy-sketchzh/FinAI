"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9958],{2440:function(e,t,l){var a=l(25519);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(a.C9))&&void 0!==e?e:"")}},88331:function(e,t,l){l.r(t),l.d(t,{default:function(){return W}});var a=l(85893),s=l(41468),n=l(80169),r=l(74434),i=l(28516),c=l(65775),o=l(25519),d=l(24019),u=l(50888),x=l(97937),m=l(63606),p=l(57132),v=l(89035),g=l(32975),f=l(45360),h=l(93967),j=l.n(h),y=l(20640),w=l.n(y),b=l(25675),_=l.n(b),k=l(39332),N=l(67294),Z=l(67421),C=l(65429),S=l(15381),P=l(65654),O=l(66309),M=l(25278),E=l(14726),J=l(55241),$=l(96074);let I=e=>{let{list:t,loading:l,feedback:s,setFeedbackOpen:n}=e,{t:r}=(0,Z.$G)(),[i,c]=(0,N.useState)([]),[o,d]=(0,N.useState)("");return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"flex flex-1 flex-wrap w-72",children:null==t?void 0:t.map(e=>{let t=i.findIndex(t=>t.reason_type===e.reason_type)>-1;return(0,a.jsx)(O.Z,{className:"text-xs text-[#525964] mb-2 p-1 px-2 rounded-md cursor-pointer ".concat(t?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{c(t=>{let l=t.findIndex(t=>t.reason_type===e.reason_type);return l>-1?[...t.slice(0,l),...t.slice(l+1)]:[...t,e]})},children:e.reason},e.reason_type)})}),(0,a.jsx)(M.default.TextArea,{placeholder:r("feedback_tip"),className:"w-64 h-20 resize-none mb-2",value:o,onChange:e=>d(e.target.value.trim())}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(E.ZP,{className:"w-16 h-8",onClick:()=>{n(!1)},children:r("cancel")}),(0,a.jsx)(E.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=i.map(e=>e.reason_type);await (null==s?void 0:s({feedback_type:"unlike",reason_types:e,remark:o}))},loading:l,children:r("verify")})]})]})};var F=e=>{var t,l;let{content:s}=e,{t:r}=(0,Z.$G)(),i=(0,k.useSearchParams)(),c=null!==(l=null==i?void 0:i.get("id"))&&void 0!==l?l:"",[o,d]=f.ZP.useMessage(),[u,x]=(0,N.useState)(!1),[m,v]=(0,N.useState)(null==s?void 0:null===(t=s.feedback)||void 0===t?void 0:t.feedback_type),[g,h]=(0,N.useState)(),y=async e=>{let t=null==e?void 0:e.replace(/\trelations:.*/g,""),l=w()(t);l?t?o.open({type:"success",content:r("copy_success")}):o.open({type:"warning",content:r("copy_nothing")}):o.open({type:"error",content:r("copy_failed")})},{run:b,loading:_}=(0,P.Z)(async e=>await (0,n.Vx)((0,n.zx)({conv_uid:c,message_id:s.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,t]=e;v(null==t?void 0:t.feedback_type),f.ZP.success(r("feedback_success")),x(!1)}}),{run:O}=(0,P.Z)(async()=>await (0,n.Vx)((0,n.Jr)()),{manual:!0,onSuccess:e=>{let[,t]=e;h(t||[]),t&&x(!0)}}),{run:M}=(0,P.Z)(async()=>await (0,n.Vx)((0,n.Ir)({conv_uid:c,message_id:(null==s?void 0:s.order)+""})),{manual:!0,onSuccess:e=>{let[,t]=e;t&&(v("none"),f.ZP.success(r("operation_success")))}});return(0,a.jsxs)(a.Fragment,{children:[d,(0,a.jsxs)("div",{className:"flex flex-1 items-center text-sm px-4",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(C.Z,{className:j()("cursor-pointer",{"text-[#0C75FC]":"like"===m}),onClick:async()=>{if("like"===m){await M();return}await b({feedback_type:"like"})}}),(0,a.jsx)(J.Z,{placement:"bottom",autoAdjustOverflow:!0,destroyTooltipOnHide:!0,content:(0,a.jsx)(I,{setFeedbackOpen:x,feedback:b,list:g||[],loading:_}),trigger:"click",open:u,children:(0,a.jsx)(S.Z,{className:j()("cursor-pointer",{"text-[#0C75FC]":"unlike"===m}),onClick:async()=>{if("unlike"===m){await M();return}await O()}})})]}),(0,a.jsx)($.Z,{type:"vertical"}),(0,a.jsx)(p.Z,{className:"cursor-pointer",onClick:()=>y(s.context)})]})]})},V=l(50228),A=l(48218),B=l(39718),G=(0,N.memo)(e=>{var t;let{model:l}=e,s=(0,k.useSearchParams)(),n=null!==(t=null==s?void 0:s.get("scene"))&&void 0!==t?t:"";return"chat_agent"===n?(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white dark:bg-[rgba(255,255,255,0.16)]",children:(0,a.jsx)(A.Z,{scene:n})}):l?(0,a.jsx)(B.Z,{width:32,height:32,model:l}):(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white dark:bg-[rgba(255,255,255,0.16)]",children:(0,a.jsx)(V.Z,{})})});let z=()=>{var e;let t=JSON.parse(null!==(e=localStorage.getItem(o.C9))&&void 0!==e?e:"");return t.avatar_url?(0,a.jsx)(_(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:32,height:32,src:null==t?void 0:t.avatar_url,alt:null==t?void 0:t.nick_name}):(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-tr from-[#31afff] to-[#1677ff] text-xs text-white",children:"user"})},D={todo:{bgClass:"bg-gray-500",icon:(0,a.jsx)(d.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,a.jsx)(u.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,a.jsx)(x.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,a.jsx)(m.Z,{className:"ml-2"})}},H=e=>e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"),L=e=>null==e?void 0:e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");var T=(0,N.memo)(e=>{var t;let{content:l,onLinkClick:s,isLastMessage:n=!1}=e,{t:r}=(0,Z.$G)(),o=(0,k.useSearchParams)(),d=null!==(t=null==o?void 0:o.get("scene"))&&void 0!==t?t:"",{replyLoading:x}=(0,N.useContext)(c.ChatContentContext),{context:m,model_name:h,role:y,thinking:b}=l,_=(0,N.useMemo)(()=>"view"===y,[y]),{value:C,cachePluginContext:S}=(0,N.useMemo)(()=>{if("string"!=typeof m)return{relations:[],value:"",cachePluginContext:[]};let[e,t]=m.split("	relations:"),l=t?t.split(","):[],a=[],s=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var t;let l=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(l),r="<custom-view>".concat(s,"</custom-view>");return a.push({...n,result:H(null!==(t=n.result)&&void 0!==t?t:"")}),s++,r}catch(t){return console.log(t.message,t),e}});return{relations:l,cachePluginContext:a,value:n}},[m]),P=(0,N.useMemo)(()=>({"custom-view"(e){var t;let{children:l}=e,s=+l.toString();if(!S[s])return l;let{name:n,status:r,err_msg:c,result:o}=S[s],{bgClass:d,icon:u}=null!==(t=D[r])&&void 0!==t?t:{};return(0,a.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,a.jsxs)("div",{className:j()("flex px-4 md:px-6 py-2 items-center text-white text-sm",d),children:[n,u]}),o?(0,a.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,a.jsx)(g.Z,{components:i.ZP,...i.dx,children:(0,i.CE)(null!=o?o:"")})}):(0,a.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:c})]})}}),[S]);return(0,a.jsxs)("div",{className:"flex flex-1 gap-3 mt-6",children:[(0,a.jsx)("div",{className:"flex flex-shrink-0 items-start",children:_?(0,a.jsx)(G,{model:h}):(0,a.jsx)(z,{})}),(0,a.jsxs)("div",{className:"flex ".concat("chat_agent"!==d||b?"":"flex-1"," overflow-hidden"),children:[!_&&(0,a.jsxs)("div",{className:"flex items-start gap-2 group",children:[(0,a.jsx)("div",{className:"text-sm text-[#1c2533] dark:text-white",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:"string"==typeof m&&(0,a.jsx)("div",{children:(0,a.jsx)(g.Z,{components:{...i.ZP,img:e=>{let{src:t,alt:l,...s}=e;return(0,a.jsx)("img",{src:t,alt:l||"image",className:"max-w-full md:max-w-[80%] lg:max-w-[70%] object-contain",style:{maxHeight:"200px"},...s})}},...i.dx,children:(0,i.CE)(H(C))})})}),"string"==typeof m&&m.trim()&&(0,a.jsx)("div",{className:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,a.jsx)("button",{className:"flex items-center justify-center w-6 h-6 text-[#525964] dark:text-[rgba(255,255,255,0.6)] hover:text-[#1677ff] dark:hover:text-white transition-colors",onClick:()=>{if("string"==typeof m){let e=m.replace(/\trelations:.*/g,""),t=w()(e);t?e?f.ZP.success(r("copy_to_clipboard_success")):f.ZP.warning(r("copy_nothing")||"没有内容可复制"):f.ZP.error(r("copy_to_clipboard_failed"))}},title:r("copy_to_clipboard"),children:(0,a.jsx)(p.Z,{})})})]}),_&&(0,a.jsxs)("div",{className:"flex flex-1 flex-col w-full",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-[rgba(255,255,255,0.16)] p-4 rounded-2xl rounded-tl-none mb-2",children:["object"==typeof m&&(0,a.jsxs)("div",{children:["[".concat(m.template_name,"]: "),(0,a.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:s,children:[(0,a.jsx)(v.Z,{className:"mr-1"}),m.template_introduce||"More Details"]})]}),"string"==typeof m&&"chat_agent"===d&&(0,a.jsx)(g.Z,{components:i.ZP,...i.dx,children:(0,i.CE)(L(C))}),"string"==typeof m&&"chat_agent"!==d&&(0,a.jsx)("div",{children:(0,a.jsx)(g.Z,{components:{...i.ZP,...P},...i.dx,children:(0,i.CE)(H(C))})}),b&&!m&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:r("thinking")}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,a.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]}),n&&x&&m&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[(0,a.jsx)(u.Z,{className:"text-blue-500",spin:!0}),(0,a.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("generating")})]})]}),(0,a.jsx)(F,{content:l})]})]})]})}),U=l(62418),q=l(2093),K=l(85576),Q=l(96486),R=l(57632),W=()=>{var e;let t=(0,k.useSearchParams)(),l=null!==(e=null==t?void 0:t.get("id"))&&void 0!==e?e:"",{currentDialogInfo:i,model:o}=(0,N.useContext)(s.p),{history:d,handleChat:u,refreshDialogList:x,setAppInfo:m,setModelValue:p,setTemperatureValue:v,setMaxNewTokensValue:g,setResourceValue:f}=(0,N.useContext)(c.ChatContentContext),[h,j]=(0,N.useState)(!1),[y,w]=(0,N.useState)(""),b=(0,N.useMemo)(()=>{let e=(0,Q.cloneDeep)(d);return e.filter(e=>["view","human"].includes(e.role)).map(e=>({...e,key:(0,R.Z)()}))},[d]);return(0,q.Z)(async()=>{let e=(0,U.a_)();if(e&&e.id===l){let[,l]=await (0,n.Vx)((0,n.BN)({...i}));if(l){var t,a,s,r,c,d,h,j,y;let n=(null==l?void 0:null===(t=l.param_need)||void 0===t?void 0:t.map(e=>e.type))||[],i=(null===(a=null==l?void 0:null===(s=l.param_need)||void 0===s?void 0:s.filter(e=>"model"===e.type)[0])||void 0===a?void 0:a.value)||o,w=(null===(r=null==l?void 0:null===(c=l.param_need)||void 0===c?void 0:c.filter(e=>"temperature"===e.type)[0])||void 0===r?void 0:r.value)||.6,b=(null===(d=null==l?void 0:null===(h=l.param_need)||void 0===h?void 0:h.filter(e=>"max_new_tokens"===e.type)[0])||void 0===d?void 0:d.value)||4e3,_=null===(j=null==l?void 0:null===(y=l.param_need)||void 0===y?void 0:y.filter(e=>"resource"===e.type)[0])||void 0===j?void 0:j.bind_value;m(l||{}),v(w||.6),g(b||4e3),p(i),f(_),await u(e.message,{app_code:null==l?void 0:l.app_code,model_name:i,...(null==n?void 0:n.includes("temperature"))&&{temperature:w},...(null==n?void 0:n.includes("max_new_tokens"))&&{max_new_tokens:b},...n.includes("resource")&&{select_param:"string"==typeof _?_:JSON.stringify(_)}}),await x(),localStorage.removeItem(U.rU)}}},[l,i]),(0,a.jsxs)("div",{className:"flex flex-col w-5/6 mx-auto",children:[!!b.length&&b.map((e,t)=>{let l=t===b.length-1&&"view"===e.role;return(0,a.jsx)(T,{content:e,isLastMessage:l,onLinkClick:()=>{j(!0),w(JSON.stringify(null==e?void 0:e.context,null,2))}},t)}),(0,a.jsx)(K.default,{title:"JSON Editor",open:h,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{j(!1)},onCancel:()=>{j(!1)},children:(0,a.jsx)(r.Z,{className:"w-full h-[500px]",language:"json",value:y})})]})}},39718:function(e,t,l){var a=l(85893),s=l(19284),n=l(25675),r=l.n(n),i=l(67294);t.Z=(0,i.memo)(e=>{let{width:t,height:l,model:n}=e,c=(0,i.useMemo)(()=>(0,s.ab)(n||"huggingface"),[n]);return n?(0,a.jsx)(r(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:t||24,height:l||24,src:c,alt:"llm",priority:!0}):null})}}]);