"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6818],{39718:function(e,a,s){var t=s(85893),l=s(19284),n=s(25675),c=s.n(n),i=s(67294);a.Z=(0,i.memo)(e=>{let{width:a,height:s,model:n}=e,r=(0,i.useMemo)(()=>(0,l.ab)(n||"huggingface"),[n]);return n?(0,t.jsx)(c(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:a||24,height:s||24,src:r,alt:"llm",priority:!0}):null})},7332:function(e,a,s){s.r(a);var t=s(85893),l=s(39718),n=s(18102),c=s(96074),i=s(93967),r=s.n(i),o=s(67294),d=s(67421),u=s(73913),x=s(32966);a.default=(0,o.memo)(e=>{let{message:a,index:s}=e,{scene:i}=(0,o.useContext)(u.MobileChatContext),{context:m,model_name:p,role:f,thinking:h}=a,{t:g}=(0,d.$G)(),v=(0,o.useMemo)(()=>"view"===f,[f]),y=(0,o.useRef)(null),{value:w}=(0,o.useMemo)(()=>{if("string"!=typeof m)return{relations:[],value:"",cachePluginContext:[]};let[e,a]=m.split("	relations:"),s=a?a.split(","):[],t=[],l=0,n=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var a;let s=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(s),c="<custom-view>".concat(l,"</custom-view>");return t.push({...n,result:j(null!==(a=n.result)&&void 0!==a?a:"")}),l++,c}catch(a){return console.log(a.message,a),e}});return{relations:s,cachePluginContext:t,value:n}},[m]),j=e=>e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");return(0,t.jsxs)("div",{className:r()("flex w-full",{"justify-end":!v}),ref:y,children:[!v&&(0,t.jsx)("div",{className:"flex bg-[#0C75FC]  text-white p-3 rounded-xl rounded-br-none",children:m}),v&&(0,t.jsxs)("div",{className:"flex max-w-full flex-col flex-wrap bg-white dark:bg-[rgba(255,255,255,0.16)] p-3 rounded-xl rounded-bl-none",children:["string"==typeof m&&"chat_agent"===i&&(0,t.jsx)(n.default,{children:null==w?void 0:w.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}),"string"==typeof m&&"chat_agent"!==i&&(0,t.jsx)(n.default,{children:j(w)}),h&&!m&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:g("thinking")}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]}),!h&&(0,t.jsx)(c.Z,{className:"my-2"}),(0,t.jsxs)("div",{className:r()("opacity-0 h-0 w-0",{"opacity-100 flex items-center justify-between gap-6 w-auto h-auto":!h}),children:[(0,t.jsx)(x.default,{content:a,index:s,chatDialogRef:y}),"chat_agent"!==i&&(0,t.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,t.jsx)(l.Z,{width:14,height:14,model:p}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:p})]})]})]})]})})},36818:function(e,a,s){s.r(a);var t=s(85893),l=s(67294),n=s(73913),c=s(7332);a.default=(0,l.memo)(()=>{let{history:e}=(0,l.useContext)(n.MobileChatContext),a=(0,l.useMemo)(()=>e.filter(e=>["view","human"].includes(e.role)),[e]);return(0,t.jsx)("div",{className:"flex flex-col gap-4",children:!!a.length&&a.map((e,a)=>(0,t.jsx)(c.default,{message:e,index:a},e.context+a))})})},5583:function(e,a,s){s.r(a);var t=s(85893),l=s(85265),n=s(66309),c=s(25278),i=s(14726),r=s(67294),o=s(67421);a.default=e=>{let{open:a,setFeedbackOpen:s,list:d,feedback:u,loading:x}=e,[m,p]=(0,r.useState)([]),[f,h]=(0,r.useState)(""),{t:g}=(0,o.$G)();return(0,t.jsx)(l.Z,{title:g("feedback_title"),placement:"bottom",open:a,onClose:()=>s(!1),destroyOnClose:!0,height:"auto",children:(0,t.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,t.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==d?void 0:d.map(e=>{let a=m.findIndex(a=>a.reason_type===e.reason_type)>-1;return(0,t.jsx)(n.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(a?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{p(a=>{let s=a.findIndex(a=>a.reason_type===e.reason_type);return s>-1?[...a.slice(0,s),...a.slice(s+1)]:[...a,e]})},children:e.reason},e.reason_type)})}),(0,t.jsx)(c.default.TextArea,{placeholder:g("describe_problem"),className:"h-24 resize-none mb-2",value:f,onChange:e=>h(e.target.value.trim())}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)(i.ZP,{className:"w-16 h-8",onClick:()=>{s(!1)},children:g("cancel")}),(0,t.jsx)(i.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=m.map(e=>e.reason_type);await (null==u?void 0:u({feedback_type:"unlike",reason_types:e,remark:f}))},loading:x,children:g("verify")})]})]})})}},32966:function(e,a,s){s.r(a);var t=s(85893),l=s(80169),n=s(65429),c=s(15381),i=s(57132),r=s(65654),o=s(31418),d=s(96074),u=s(14726),x=s(93967),m=s.n(x),p=s(20640),f=s.n(p),h=s(67294),g=s(67421),v=s(73913),y=s(5583);a.default=e=>{var a;let{content:s,index:x,chatDialogRef:p}=e,{conv_uid:w,history:j,scene:b}=(0,h.useContext)(v.MobileChatContext),{message:_}=o.Z.useApp(),{t:k}=(0,g.$G)(),[N,C]=(0,h.useState)(!1),[Z,S]=(0,h.useState)(null==s?void 0:null===(a=s.feedback)||void 0===a?void 0:a.feedback_type),[M,$]=(0,h.useState)([]),F=async e=>{var a;let s=null==e?void 0:e.replace(/\trelations:.*/g,""),t=f()((null===(a=p.current)||void 0===a?void 0:a.textContent)||s);t?s?_.success(k("copy_success")):_.warning(k("copy_empty")):_.error(k("copy_failed"))},{run:P,loading:V}=(0,r.Z)(async e=>await (0,l.Vx)((0,l.zx)({conv_uid:w,message_id:s.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,a]=e;S(null==a?void 0:a.feedback_type),_.success(k("feedback_success")),C(!1)}}),{run:z}=(0,r.Z)(async()=>await (0,l.Vx)((0,l.Ir)({conv_uid:w,message_id:(null==s?void 0:s.order)+""})),{manual:!0,onSuccess:e=>{let[,a]=e;a&&(S("none"),_.success(k("operation_success")))}}),{run:A}=(0,r.Z)(async()=>await (0,l.Vx)((0,l.Jr)()),{manual:!0,onSuccess:e=>{let[,a]=e;$(a||[]),a&&C(!0)}}),{run:G,loading:I}=(0,r.Z)(async()=>await (0,l.Vx)((0,l.Ty)({conv_id:w,round_index:0})),{manual:!0,onSuccess:()=>{_.success(k("operation_success"))}});return(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.Z,{className:m()("cursor-pointer",{"text-[#0C75FC]":"like"===Z}),onClick:async()=>{if("like"===Z){await z();return}await P({feedback_type:"like"})}}),(0,t.jsx)(c.Z,{className:m()("cursor-pointer",{"text-[#0C75FC]":"unlike"===Z}),onClick:async()=>{if("unlike"===Z){await z();return}await A()}}),(0,t.jsx)(y.default,{open:N,setFeedbackOpen:C,list:M,feedback:P,loading:V})]}),(0,t.jsx)(d.Z,{type:"vertical"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.Z,{className:"cursor-pointer",onClick:()=>F(s.context)}),j.length-1===x&&"chat_agent"===b&&(0,t.jsx)(u.ZP,{loading:I,size:"small",onClick:async()=>{await G()},className:"text-xs",children:k("stop_topic")})]})]})}}}]);