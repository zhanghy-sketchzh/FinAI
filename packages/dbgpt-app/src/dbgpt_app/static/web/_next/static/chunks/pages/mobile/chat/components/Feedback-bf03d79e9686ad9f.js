(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3602],{84588:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mobile/chat/components/Feedback",function(){return a(32966)}])},2440:function(e,s,a){"use strict";var n=a(25519);s.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(n.C9))&&void 0!==e?e:"")}},39718:function(e,s,a){"use strict";var n=a(85893),t=a(19284),c=a(25675),l=a.n(c),r=a(67294);s.Z=(0,r.memo)(e=>{let{width:s,height:a,model:c}=e,i=(0,r.useMemo)(()=>(0,t.ab)(c||"huggingface"),[c]);return c?(0,n.jsx)(l(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:a||24,src:i,alt:"llm",priority:!0}):null})},5583:function(e,s,a){"use strict";a.r(s);var n=a(85893),t=a(85265),c=a(66309),l=a(25278),r=a(14726),i=a(67294),o=a(67421);s.default=e=>{let{open:s,setFeedbackOpen:a,list:u,feedback:d,loading:p}=e,[x,m]=(0,i.useState)([]),[f,_]=(0,i.useState)(""),{t:y}=(0,o.$G)();return(0,n.jsx)(t.Z,{title:y("feedback_title"),placement:"bottom",open:s,onClose:()=>a(!1),destroyOnClose:!0,height:"auto",children:(0,n.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,n.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==u?void 0:u.map(e=>{let s=x.findIndex(s=>s.reason_type===e.reason_type)>-1;return(0,n.jsx)(c.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(s?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{m(s=>{let a=s.findIndex(s=>s.reason_type===e.reason_type);return a>-1?[...s.slice(0,a),...s.slice(a+1)]:[...s,e]})},children:e.reason},e.reason_type)})}),(0,n.jsx)(l.default.TextArea,{placeholder:y("describe_problem"),className:"h-24 resize-none mb-2",value:f,onChange:e=>_(e.target.value.trim())}),(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(r.ZP,{className:"w-16 h-8",onClick:()=>{a(!1)},children:y("cancel")}),(0,n.jsx)(r.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=x.map(e=>e.reason_type);await (null==d?void 0:d({feedback_type:"unlike",reason_types:e,remark:f}))},loading:p,children:y("verify")})]})]})})}},32966:function(e,s,a){"use strict";a.r(s);var n=a(85893),t=a(80169),c=a(65429),l=a(15381),r=a(57132),i=a(65654),o=a(31418),u=a(96074),d=a(14726),p=a(93967),x=a.n(p),m=a(20640),f=a.n(m),_=a(67294),y=a(67421),k=a(73913),h=a(5583);s.default=e=>{var s;let{content:a,index:p,chatDialogRef:m}=e,{conv_uid:v,history:b,scene:g}=(0,_.useContext)(k.MobileChatContext),{message:w}=o.Z.useApp(),{t:C}=(0,y.$G)(),[N,j]=(0,_.useState)(!1),[Z,S]=(0,_.useState)(null==a?void 0:null===(s=a.feedback)||void 0===s?void 0:s.feedback_type),[E,O]=(0,_.useState)([]),P=async e=>{var s;let a=null==e?void 0:e.replace(/\trelations:.*/g,""),n=f()((null===(s=m.current)||void 0===s?void 0:s.textContent)||a);n?a?w.success(C("copy_success")):w.warning(C("copy_empty")):w.error(C("copy_failed"))},{run:F,loading:I}=(0,i.Z)(async e=>await (0,t.Vx)((0,t.zx)({conv_uid:v,message_id:a.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,s]=e;S(null==s?void 0:s.feedback_type),w.success(C("feedback_success")),j(!1)}}),{run:T}=(0,i.Z)(async()=>await (0,t.Vx)((0,t.Ir)({conv_uid:v,message_id:(null==a?void 0:a.order)+""})),{manual:!0,onSuccess:e=>{let[,s]=e;s&&(S("none"),w.success(C("operation_success")))}}),{run:V}=(0,i.Z)(async()=>await (0,t.Vx)((0,t.Jr)()),{manual:!0,onSuccess:e=>{let[,s]=e;O(s||[]),s&&j(!0)}}),{run:z,loading:A}=(0,i.Z)(async()=>await (0,t.Vx)((0,t.Ty)({conv_id:v,round_index:0})),{manual:!0,onSuccess:()=>{w.success(C("operation_success"))}});return(0,n.jsxs)("div",{className:"flex items-center text-sm",children:[(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(c.Z,{className:x()("cursor-pointer",{"text-[#0C75FC]":"like"===Z}),onClick:async()=>{if("like"===Z){await T();return}await F({feedback_type:"like"})}}),(0,n.jsx)(l.Z,{className:x()("cursor-pointer",{"text-[#0C75FC]":"unlike"===Z}),onClick:async()=>{if("unlike"===Z){await T();return}await V()}}),(0,n.jsx)(h.default,{open:N,setFeedbackOpen:j,list:E,feedback:F,loading:I})]}),(0,n.jsx)(u.Z,{type:"vertical"}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(r.Z,{className:"cursor-pointer",onClick:()=>P(a.context)}),b.length-1===p&&"chat_agent"===g&&(0,n.jsx)(d.ZP,{loading:A,size:"small",onClick:async()=>{await z()},className:"text-xs",children:C("stop_topic")})]})]})}}},function(e){e.O(0,[2913,3791,5278,8791,4330,7611,5418,5030,26,2086,5914,2834,6562,5265,7632,9834,9562,9774,2888,179],function(){return e(e.s=84588)}),_N_E=e.O()}]);