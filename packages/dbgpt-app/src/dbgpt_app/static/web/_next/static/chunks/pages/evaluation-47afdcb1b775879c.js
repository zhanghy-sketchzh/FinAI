(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4574],{40201:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/evaluation",function(){return t(38266)}])},38266:function(e,a,t){"use strict";t.r(a);var l=t(85893),s=t(76212),n=t(45605),d=t(88484),i=t(65654),o=t(25278),r=t(99859),c=t(66309),u=t(42075),m=t(86738),p=t(45360),x=t(14726),f=t(40411),_=t(74309),h=t(83062),v=t(28459),g=t(92783),b=t(55054),j=t(85576),y=t(34041),w=t(23799),k=t(67294),Z=t(67421);let{TextArea:S}=o.default,{useWatch:C}=r.default;a.default=()=>{let{t:e}=(0,Z.$G)(),[a,t]=(0,k.useState)(!1),[I,P]=(0,k.useState)(!1),[N,F]=(0,k.useState)([]),[V,O]=(0,k.useState)(0),[R,U]=(0,k.useState)(0),[L,E]=(0,k.useState)(),[q,W]=(0,k.useState)(),[D,K]=(0,k.useState)(!1),[T,X]=(0,k.useState)("evaluations"),[$,A]=(0,k.useState)(!1),[B,J]=(0,k.useState)(!0),[M,Y]=(0,k.useState)([{}]),[z,G]=(0,k.useState)(),[H,Q]=(0,k.useState)([]),[ee,ea]=(0,k.useState)(""),[et,el]=(0,k.useState)(!1),[es,en]=(0,k.useState)(!1),[ed,ei]=(0,k.useState)(!1),eo=(0,k.useMemo)(()=>null==H?void 0:H.map(e=>({label:null==e?void 0:e.name,value:null==e?void 0:e.code})),[H]),[er]=r.default.useForm(),[ec]=r.default.useForm(),{run:eu,loading:em}=(0,i.Z)(async e=>{let[a,t]=await (0,s.Vx)((0,s.Kt)(e));return t},{manual:!0,onSuccess:e=>{W(null==e?void 0:e.map(e=>({label:e.describe,value:e.name})))}}),{run:ep,loading:ex}=(0,i.Z)(async e=>{let[a,t]=await (0,s.Vx)((0,s.YK)(e));return t},{manual:!0,onSuccess:e=>{e&&e.length&&(Y(e),A(!0))}}),{run:ef,loading:e_,refresh:eh}=(0,i.Z)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,[t,l]=await (0,s.Vx)((0,s.Wm)({page:e,page_size:a}));return l},{onSuccess:e=>{F(null==e?void 0:e.items),O(null==e?void 0:e.total_count)}}),{run:ev,loading:eg,refresh:eb}=(0,i.Z)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,[t,l]=await (0,s.Vx)((0,s.a$)({page:e,page_size:a}));return l},{onSuccess:e=>{Q(null==e?void 0:e.items),U(null==e?void 0:e.total_count)}}),ej=[{title:e("Name"),dataIndex:"name",key:"name",width:"10%",fixed:"left"},{title:e("evaluation_code"),dataIndex:"code",key:"code",width:"20%"},{title:e("storage_type"),dataIndex:"storage_type",key:"storage_type"},{title:e("dataset_name"),dataIndex:"datasets_count",key:"datasets_count"},{title:e("create_time"),dataIndex:"gmt_create",key:"gmt_create"},{title:e("members"),dataIndex:"members",key:"members",width:"10%",render:e=>null==e?void 0:e.split(",").map(e=>(0,l.jsx)(c.Z,{children:e},e))},{title:e("finish_time"),dataIndex:"gmt_modified",key:"gmt_modified"},{title:e("operator"),key:"action",render:(a,t)=>(0,l.jsxs)(u.Z,{size:"middle",children:[(0,l.jsx)(m.Z,{title:e("confirm_delete"),onConfirm:async()=>{let[,,a]=await (0,s.Vx)((0,s.$E)({code:null==t?void 0:t.code}));(null==a?void 0:a.success)==!0&&(p.ZP.success(e("delete_success")),eb())},children:(0,l.jsx)(x.ZP,{type:"link",children:e("Delete")})}),(0,l.jsx)(x.ZP,{type:"link",onClick:()=>{var e;J(!1),P(!0),ea(null==t?void 0:t.code),ec.setFieldsValue({dataset_name:null==t?void 0:t.name,members:null==t?void 0:null===(e=t.members)||void 0===e?void 0:e.split(",")})},children:e("Edit")}),(0,l.jsx)(x.ZP,{type:"link",loading:ed,onClick:async()=>{ei(!0);let e=await (0,s.Ug)({code:null==t?void 0:t.code}),a=e.headers["content-type"];if(a.includes("application/json")){let a=new FileReader;a.onload=()=>{try{let e=JSON.parse(a.result);p.ZP.error(e.err_msg)}catch(e){console.error("Failed to parse error response:",e)}},a.readAsText(e.data)}else{let a=e.headers["content-disposition"],t="downloaded_file.xlsx";if(a){let e=a.match(/filename\*?="?(.+)"/);e[1]&&(t=decodeURIComponent(e[1]))}let l=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),s=document.createElement("a");s.href=l,s.download=t,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(l)}ei(!1)},children:e("Download")})]})}],ey=[{title:e("dataset_name"),dataIndex:"datasets_name",key:"datasets_name",fixed:"left",width:"15%",render:e=>(0,l.jsx)("span",{style:{textWrap:"nowrap",maxWidth:"300px"},children:e})},{title:e("evaluation_status"),dataIndex:"state",key:"state",render:e=>(0,l.jsx)(f.Z,{style:{textWrap:"nowrap"},status:"failed"==e?"error":"success",text:e})},{title:e("evaluation_code"),dataIndex:"evaluate_code",key:"evaluate_code"},{title:e("scene"),dataIndex:"scene_key",key:"scene_key"},{title:e("evaluation_metrics"),dataIndex:"evaluate_metrics",key:"evaluate_metrics"},{title:e("create_time"),dataIndex:"gmt_create",key:"gmt_create"},{title:e("finish_time"),dataIndex:"gmt_modified",key:"gmt_modified"},_.Z.EXPAND_COLUMN,{title:(0,l.jsxs)("span",{className:"w-[50px]",children:[(0,l.jsx)("span",{className:"text-nowrap",children:e("details")}),(0,l.jsx)(h.Z,{placement:"topLeft",title:e("details_tooltip"),children:(0,l.jsx)(n.Z,{})})]}),render:()=>(0,l.jsx)("div",{style:{minWidth:"50px"}})},{title:e("evaluation_result"),key:"result",render:(a,t)=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.ZP,{type:"link",loading:ex,onClick:async()=>{ep({evaluate_code:null==t?void 0:t.evaluate_code})},children:e("score_details")}),(0,l.jsx)(x.ZP,{type:"link",loading:ed,onClick:async()=>{ei(!0);let e=await (0,s.XI)({evaluate_code:null==t?void 0:t.evaluate_code}),a=e.headers["content-type"];if(a.includes("application/json")){let a=new FileReader;a.onload=()=>{try{let e=JSON.parse(a.result);p.ZP.error(e.err_msg)}catch(e){console.error("Failed to parse error response:",e)}},a.readAsText(e.data)}else{let a=e.headers["content-disposition"],t="downloaded_file.xlsx";if(a){let e=a.match(/filename\*?="?(.+)"/);e[1]&&(t=decodeURIComponent(e[1]))}let l=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),s=document.createElement("a");s.href=l,s.download=t,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(l)}ei(!1)},children:e("Download")})]})},{title:e("operator"),key:"action",width:"25%",render:(a,t)=>(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(m.Z,{title:e("confirm_delete"),onConfirm:async()=>{let[,,a]=await (0,s.Vx)((0,s.Wd)({evaluation_code:null==t?void 0:t.evaluate_code}));(null==a?void 0:a.success)==!0&&(p.ZP.success(e("delete_success")),eh())},children:(0,l.jsx)(x.ZP,{type:"link",children:e("Delete")})})})}],ew=()=>{A(!1)};return(0,l.jsx)(v.ZP,{theme:{components:{Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsx)("div",{className:"flex flex-col h-full w-full  dark:bg-gradient-dark bg-gradient-light bg-cover bg-center",children:(0,l.jsxs)("div",{className:"px-6 py-2 overflow-y-auto",children:[(0,l.jsx)(g.Z,{className:"backdrop-filter backdrop-blur-lg bg-white bg-opacity-30 border-2 border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:[{label:e("evaluation_data"),value:"evaluations"},{label:e("dataset"),value:"dataSet"}],onChange:e=>{X(e)},value:T}),"dataSet"===T&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex flex-row-reverse mb-4",children:(0,l.jsx)(x.ZP,{className:"border-none text-white bg-button-gradient h-full",onClick:()=>{P(!0),J(!0)},children:e("add_dataset")})}),(0,l.jsx)(_.Z,{pagination:{total:R,onChange(e){ev(e)}},scroll:{x:1300},loading:eg,columns:ej,dataSource:H})]}),"evaluations"===T&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex flex-row-reverse mb-4",children:(0,l.jsx)(x.ZP,{className:"border-none text-white bg-button-gradient h-full",onClick:()=>{t(!0)},children:e("start_evaluation")})}),(0,l.jsx)(_.Z,{pagination:{total:V,onChange(e){ef(e)}},rowKey:e=>e.evaluate_code,expandable:{expandedRowRender:e=>{let{average_score:a,log_info:t}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(()=>{if(!a)return(0,l.jsx)(l.Fragment,{});try{var e;let t=JSON.parse(a);return(0,l.jsx)("div",{className:"flex flex-row gap-1",children:null===(e=Object.entries(t))||void 0===e?void 0:e.map(e=>{let[a,t]=e;return(0,l.jsx)(b.Z,{title:a,value:t},a)})})}catch(e){return(0,l.jsx)(l.Fragment,{})}})(),t&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500 text-sm",children:"logï¼š"}),(0,l.jsx)("span",{children:t})]})]})}},scroll:{x:"100%"},loading:e_,columns:ey,dataSource:N})]}),(0,l.jsx)(j.default,{title:e("start_evaluation"),open:a,onOk:async()=>{let a=await er.validateFields();if(en(!0),a){let[,,t]=await (0,s.Vx)((0,s.kg)({...a}));(null==t?void 0:t.success)&&(p.ZP.success(e("start_success")),eh(),er.resetFields())}t(!1),en(!1)},confirmLoading:es,onCancel:()=>{t(!1)},children:(0,l.jsxs)(r.default,{name:"basic",form:er,initialValues:{remember:!0},autoComplete:"off",labelCol:{span:4},wrapperCol:{span:20},children:[(0,l.jsx)(r.default.Item,{name:"scene_key",label:e("scene_type"),rules:[{required:!0}],children:(0,l.jsx)(y.default,{options:[{value:"recall",label:"recall"},{value:"app",label:"app"}],onChange:async e=>{if(K(!0),er.setFieldValue("scene_value",""),"recall"===e){let e=await (0,s.Vm)();e.data.success&&E(e.data.data.map(e=>({label:e.name,value:e.id.toString()})))}else{let e=await (0,s.yk)({});e.data.success&&E(e.data.data.app_list.map(e=>({label:e.app_name,value:e.app_code})))}K(!1)}})}),(0,l.jsx)(r.default.Item,{name:"scene_value",label:e("scene_params"),rules:[{required:!0}],children:(0,l.jsx)(y.default,{loading:D,disabled:D,options:L,onChange:e=>{er.getFieldValue("scene_key")&&eu({scene_key:er.getFieldValue("scene_key"),scene_value:e})}})}),(0,l.jsx)(r.default.Item,{name:"parallel_num",label:e("parallel_params"),rules:[{required:!0}],initialValue:1,children:(0,l.jsx)(o.default,{})}),(0,l.jsx)(r.default.Item,{name:"datasets",label:e("dataset"),rules:[{required:!0}],children:(0,l.jsx)(y.default,{options:eo})}),(0,l.jsx)(r.default.Item,{name:"evaluate_metrics",label:e("evaluation_metrics"),rules:[{required:"app"===C("scene_key",er)}],children:(0,l.jsx)(y.default,{loading:em,disabled:em,options:q})})]})}),(0,l.jsx)(j.default,{title:B?e("add_dataset"):e("edit_dataset"),open:I,confirmLoading:et,onOk:()=>{ec.validateFields().then(a=>{if(el(!0),B){let t=a.storage_type;if("oss"===t){let t=new FormData;t.append("dataset_name",a.dataset_name),a.members&&t.append("members",a.members.join(","));let l=a.doc_file.file;t.append("doc_file",l,l.name),(0,s.L$)(t).then(a=>{a.data.success?(p.ZP.success(e("upload_success")),ev()):p.ZP.error(a.data.err_msg)}).catch(a=>{var t,l;console.error("upload failed",a),p.ZP.error((null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(l=t.data)||void 0===l?void 0:l.err_msg)||e("upload_failed"))}).finally(()=>{P(!1),el(!1)})}else"db"===t&&(0,s.h)({dataset_name:a.dataset_name,members:a.members.join(","),content:a.content}).then(a=>{a.data.success?(p.ZP.success(e("upload_success")),ev()):p.ZP.error(a.data.err_msg)}).catch(a=>{var t,l;console.log(a),p.ZP.error((null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(l=t.data)||void 0===l?void 0:l.err_msg)||e("upload_failed"))}).finally(()=>{P(!1),el(!1),ec.resetFields()})}else(0,s.w_)({code:ee,members:a.members.join(",")}).then(a=>{a.data.success?(p.ZP.success(e("update_success_msg")),ev()):p.ZP.error(a.data.err_msg)}).catch(a=>{console.log(a),p.ZP.error(e("update_failed_msg"))}).finally(()=>{P(!1),el(!1)})})},onCancel:()=>{P(!1)},children:(0,l.jsxs)(r.default,{name:"basic",form:ec,initialValues:{remember:!0},autoComplete:"off",labelCol:{span:4},wrapperCol:{span:20},children:[(0,l.jsx)(r.default.Item,{name:"dataset_name",label:e("Name"),rules:[{required:!0}],children:(0,l.jsx)(o.default,{disabled:!B})}),(0,l.jsx)(r.default.Item,{name:"members",label:e("members"),children:(0,l.jsx)(y.default,{mode:"tags"})}),B&&(0,l.jsx)(r.default.Item,{name:"storage_type",label:e("storage_type"),rules:[{required:!0}],children:(0,l.jsx)(y.default,{options:z})}),"oss"===C("storage_type",ec)&&B&&(0,l.jsx)(r.default.Item,{name:"doc_file",label:"doc_file",rules:[{required:!0}],children:(0,l.jsx)(w.default,{name:"dataSet",maxCount:1,beforeUpload:e=>(ec.setFieldsValue({doc_file:e}),!1),onRemove:()=>{ec.setFieldsValue({doc_file:void 0})},children:(0,l.jsx)(x.ZP,{icon:(0,l.jsx)(d.Z,{}),children:"Click to Upload"})})}),"db"===C("storage_type",ec)&&B&&(0,l.jsx)(r.default.Item,{name:"content",label:"content",rules:[{required:!0}],children:(0,l.jsx)(S,{rows:8})})]})}),(0,l.jsx)(j.default,{title:e("score_details"),open:$,onOk:ew,onCancel:ew,styles:{body:{maxHeight:"500px",overflowY:"auto",minWidth:"700px"}},style:{minWidth:"750px"},footer:[(0,l.jsx)(x.ZP,{onClick:ew,children:e("return")},"back")],children:(0,l.jsx)(_.Z,{columns:Object.keys(null==M?void 0:M[0]).map(e=>({title:e,dataIndex:e,key:e})),style:{minWidth:"700px"},dataSource:M,rowKey:"code",pagination:!1})})]})})})}}},function(e){e.O(0,[2913,3791,5278,4330,7611,8791,1049,2783,4567,1300,9859,4309,3303,411,4298,9774,2888,179],function(){return e(e.s=40201)}),_N_E=e.O()}]);